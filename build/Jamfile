#
# Copyright (c) 2025 Mohammad Nejati
#
# Distributed under the Boost Software License, Version 1.0. (See accompanying
# file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#
# Official repository: https://github.com/cppalliance/capy
#

import ac ;
import config : requires ;

constant c11-requires :
    [ requires
    cxx11_constexpr
    cxx11_decltype
    cxx11_hdr_tuple
    cxx11_template_aliases
    cxx11_variadic_templates
    ]
    ;

path-constant CAPY_ROOT : .. ;

project boost/capy
  : requirements
    $(c11-requires)
    <define>BOOST_CAPY_SOURCE
  : common-requirements
    <link>shared:<define>BOOST_CAPY_DYN_LINK
    <link>static:<define>BOOST_CAPY_STATIC_LINK
  : usage-requirements
    <define>BOOST_CAPY_NO_LIB
  : source-location $(CAPY_ROOT)
  ;

alias capy_sources : [ glob-tree-ex ./src : *.cpp ] ;

lib boost_capy
  : capy_sources
  : requirements
  : usage-requirements
  ;

# Zlib
using zlib ;

alias capy_zlib_sources : [ glob-tree-ex ./src_zlib : *.cpp ] ;

lib boost_capy_zlib
  : capy_zlib_sources
  : requirements
    <library>/boost/capy//boost_capy
    [ ac.check-library /zlib//zlib : <library>/zlib//zlib : <build>no ]
  : usage-requirements
    <library>/boost/capy//boost_capy
    <define>BOOST_CAPY_HAS_ZLIB
  ;

# Brotli
using brotli ;

alias capy_brotli_sources : [ glob-tree-ex ./src_brotli : *.cpp ] ;

lib boost_capy_brotli
  : capy_brotli_sources
  : requirements
    <library>/boost/capy//boost_capy
    [ ac.check-library /brotli//brotlicommon : <library>/brotli//brotlicommon : <build>no ]
    [ ac.check-library /brotli//brotlidec : <library>/brotli//brotlidec : <build>no ]
    [ ac.check-library /brotli//brotlienc : <library>/brotli//brotlienc : <build>no ]
  : usage-requirements
    <library>/boost/capy//boost_capy
    <define>BOOST_CAPY_HAS_BROTLI
  ;

boost-install boost_capy boost_capy_zlib boost_capy_brotli ;
